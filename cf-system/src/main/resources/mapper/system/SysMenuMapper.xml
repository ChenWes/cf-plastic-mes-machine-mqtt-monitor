<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cf.system.mapper.SysMenuMapper">

	<resultMap type="SysMenu" id="SysMenuResult">
		<id     property="menuId"         column="menu_id"        />
		<result property="menuCode"       column="menu_code"      />
		<result property="menuName"       column="menu_name"      />
		<result property="parentId"       column="parent_id"      />
		<result property="seqNo"       column="seq_no"      />
		<result property="path"           column="path"           />
		<result property="menuType"       column="menu_type"      />
		<result property="status"         column="status"         />
		<result property="hideFlag"         column="hide_flag"         />
		<result property="icon"           column="icon"           />
		<result property="createBy"       column="create_by"      />
		<result property="createTime"     column="create_time"    />
		<result property="updateTime"     column="update_time"    />
		<result property="updateBy"       column="update_by"      />
		<result property="remark"         column="remark"         />
	</resultMap>

	<sql id="getMenuSql">
		SELECT `sys_menu`.`menu_id`,
		`sys_menu`.`menu_code`,
		`sys_menu`.`menu_name`,
		`sys_menu`.`parent_id`,
		`sys_menu`.`seq_no`,
		`sys_menu`.`path`,
		`sys_menu`.`status`,
		`sys_menu`.`menu_type`,
		`sys_menu`.`icon`,
		`sys_menu`.`hide_flag`,
		`sys_menu`.`remark`,
		`sys_menu`.`create_by`,
		`sys_menu`.`create_time`,
		`sys_menu`.`update_by`,
		`sys_menu`.`update_time`
		FROM `sys_menu`
    </sql>
    
    <select id="getMenuList" parameterType="SysMenu" resultMap="SysMenuResult">
		<include refid="getMenuSql"/>
		<where>
			<if test="menuName != null and menuName != ''">
				AND (menu_name like concat('%', #{menuName}, '%') or menu_id in (select record_id from sys_lang_info where table_name='sys_menu' and column_name='menu_name' and value like concat('%', #{menuName}, '%')))
			</if>
			<if test="menuCode != null and menuCode != ''">
				AND menu_code like concat('%', #{menuCode}, '%')
			</if>
			<if test="menuType != null and menuType != ''">
				AND menu_type like concat('%', #{menuType}, '%')
			</if>
			<if test="path != null and path != ''">
				AND path like concat('%', #{path}, '%')
			</if>
			<if test="hideFlag != null and hideFlag != ''">
				AND hide_flag = #{hideFlag}
			</if>
			<if test="remark != null and remark != ''">
				AND remark like concat('%', #{remark}, '%')
			</if>
			<if test="status != null and status != ''">
				AND status = #{status}
			</if>
		</where>
		order by parent_id, seq_no
	</select>

	<select id="getMenuById" parameterType="Long" resultMap="SysMenuResult">
		<include refid="getMenuSql"/>
		where menu_id = #{menuId}
	</select>

	<select id="getMenuByCode" parameterType="String" resultMap="SysMenuResult">
		<include refid="getMenuSql"/>
		where menu_code = #{menuCode}
	</select>

	<update id="updateMenu" parameterType="SysMenu">
		update sys_menu
		<set>
			<if test="menuName != null and menuName != ''">menu_name = #{menuName},</if>
			<if test="parentId != null">parent_id = #{parentId},</if>
			<if test="seqNo != null ">seq_no = #{seqNo},</if>
			<if test="path != null and path != ''">path = #{path},</if>
			<if test="menuType != null and menuType != ''">menu_type = #{menuType},</if>
			<if test="status != null">status = #{status},</if>
			<if test="icon !=null">icon = #{icon},</if>
			<if test="hideFlag !=null">hide_flag = #{hideFlag},</if>
			<if test="remark != null">remark = #{remark},</if>
			<if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime}</if>
		</set>
		where menu_id = #{menuId}
	</update>

	<insert id="insertMenu" parameterType="SysMenu" useGeneratedKeys="true" keyProperty="menuId">
		insert into sys_menu(
		<if test="menuId != null and menuId != 0">menu_id,</if>
		<if test="parentId != null ">parent_id,</if>

		<if test="menuCode != null">menu_code,</if>
		<if test="menuName != null">menu_name,</if>
		<if test="seqNo != null ">seq_no,</if>
		<if test="path != null">path,</if>
		<if test="menuType != null">menu_type,</if>

		<if test="status != null">status,</if>
		<if test="icon != null">icon,</if>
		<if test="remark != null">remark,</if>

		<if test="createBy != null">create_by,</if>
        <if test="createTime != null">create_time</if>
		) values(
		<if test="menuId != null and menuId != 0">#{menuId},</if>
		<if test="parentId != null ">#{parentId},</if>

		<if test="menuCode != null">#{menuCode},</if>
		<if test="menuName != null">#{menuName},</if>
		<if test="seqNo != null ">#{seqNo},</if>
		<if test="path != null">#{path},</if>
		<if test="menuType != null">#{menuType},</if>

		<if test="status != null">#{status},</if>
		<if test="icon != null">#{icon},</if>
		<if test="remark != null">#{remark},</if>

		<if test="createBy != null">#{createBy},</if>
        <if test="createTime != null">#{createTime}</if>
		)
	</insert>
	
	<delete id="deleteMenuById" parameterType="Long">
	    delete from sys_menu where menu_id = #{menuId}
	</delete>

	<delete id="deleteMenuByIds" parameterType="Long">
		delete from sys_menu where  menu_id in
		<foreach collection="array" item="menuId" open="(" separator="," close=")">
			#{menuId}
		</foreach>
	</delete>

</mapper> 